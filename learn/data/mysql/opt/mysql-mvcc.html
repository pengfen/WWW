MVCC 多版本并发控制

MVCC 是行级锁的一个变种 在很多情况下避免了加锁操作 开销更低 虽然实现机制有所不同 但大都实现了非阻塞的读操作 写操作也只能锁定必要的行

InnoDB的MVCC 是通过在每行记录后面保存两个隐藏的列来实现的 一个保存行的创建时间 一个保存行的过期时间(或删除时间 系统版本号system version number) 每开始一个新的事务 系统版本号都会自动递增

SELECT
    InnoDB 会根据以下两个条件检查每行记录
    InnoDB 只查找版本早于当前事务版本的数据行
    行的删除版本要么未定义 要么大于当前事务版本号
INSERT
    InnoDB 为新插入的每一行保存当前系统版本号作为行版本号
DELETE
    InnoDB 为删除的每一行保存当前系统版本号作为行删除标识
UPDATE
    InnoDB 为插入一行新记录 保存当前系统版本号作为行版本号
